<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Keychron Q1 HE Keymap Editor</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}

body{
font-family:sans-serif;
background:#1a1a2e;
color:#eee;
padding:20px;
}

h1{color:#00d4ff;text-align:center;margin-bottom:20px}

/* ⭐ 変更：absolute描画 */
.keyboard{
position:relative;
margin:auto;
}

.key{
position:absolute;
height:50px;
background:#333;
border:1px solid #555;
border-radius:6px;
display:flex;
align-items:center;
justify-content:center;
font-size:11px;
cursor:pointer;
}

.key:hover{background:#444}
.transparent{opacity:.35}
.selected{outline:2px solid #00d4ff}

.layer-tabs{display:flex;gap:10px;justify-content:center;margin-bottom:20px}
.layer-tab{padding:8px 14px;background:#333;border-radius:6px;cursor:pointer}
.layer-tab.active{background:#00d4ff;color:#000}

.editor-panel{
margin-top:25px;
background:#2d2d44;
padding:15px;
border-radius:8px;
display:none;
}

.btn{padding:8px 12px;margin:5px;cursor:pointer}
</style>
</head>
<body>
<h1>⌨️ Keychron Q1 HE Keymap Editor</h1>
<div class="layer-tabs" id="layerTabs"></div>
<div class="keyboard" id="keyboard"></div>
<div class="editor-panel" id="editorPanel">
<input id="keycodeInput" style="width:200px">
<button onclick="applyKeycode()">適用</button>
<button onclick="closeEditor()">閉じる</button>
</div>
<div style="margin-top:20px;text-align:center">
<button onclick="downloadKeymap()">keymap.c DL</button>
<button onclick="saveToLocal()">保存</button>
<button onclick="loadFromLocal()">読込</button>
</div>
<script>

/* =========================
   QMK keyboard.json 反映
========================= */

const rawLayout =
[
{"matrix":[0,0],"x":0,"y":0},
{"matrix":[0,1],"x":1.25,"y":0},
{"matrix":[0,2],"x":2.25,"y":0},
{"matrix":[0,3],"x":3.25,"y":0},
{"matrix":[0,4],"x":4.25,"y":0},
{"matrix":[0,5],"x":5.5,"y":0},
{"matrix":[0,6],"x":6.5,"y":0},
{"matrix":[0,7],"x":7.5,"y":0},
{"matrix":[0,8],"x":8.5,"y":0},
{"matrix":[0,9],"x":9.75,"y":0},
{"matrix":[0,10],"x":10.75,"y":0},
{"matrix":[0,11],"x":11.75,"y":0},
{"matrix":[0,12],"x":12.75,"y":0},
{"matrix":[0,13],"x":14,"y":0},
{"matrix":[0,14],"x":15.25,"y":0},

{"matrix":[1,0],"x":0,"y":1.25},
{"matrix":[1,1],"x":1,"y":1.25},
{"matrix":[1,2],"x":2,"y":1.25},
{"matrix":[1,3],"x":3,"y":1.25},
{"matrix":[1,4],"x":4,"y":1.25},
{"matrix":[1,5],"x":5,"y":1.25},
{"matrix":[1,6],"x":6,"y":1.25},
{"matrix":[1,7],"x":7,"y":1.25},
{"matrix":[1,8],"x":8,"y":1.25},
{"matrix":[1,9],"x":9,"y":1.25},
{"matrix":[1,10],"x":10,"y":1.25},
{"matrix":[1,11],"x":11,"y":1.25},
{"matrix":[1,12],"x":12,"y":1.25},
{"matrix":[1,13],"x":13,"y":1.25,"w":2},
{"matrix":[1,14],"x":15.25,"y":1.25},

{"matrix":[2,0],"x":0,"y":2.25,"w":1.5},
{"matrix":[2,1],"x":1.5,"y":2.25},
{"matrix":[2,2],"x":2.5,"y":2.25},
{"matrix":[2,3],"x":3.5,"y":2.25},
{"matrix":[2,4],"x":4.5,"y":2.25},
{"matrix":[2,5],"x":5.5,"y":2.25},
{"matrix":[2,6],"x":6.5,"y":2.25},
{"matrix":[2,7],"x":7.5,"y":2.25},
{"matrix":[2,8],"x":8.5,"y":2.25},
{"matrix":[2,9],"x":9.5,"y":2.25},
{"matrix":[2,10],"x":10.5,"y":2.25},
{"matrix":[2,11],"x":11.5,"y":2.25},
{"matrix":[2,12],"x":12.5,"y":2.25},
{"matrix":[2,13],"x":13.5,"y":2.25,"w":1.5},
{"matrix":[2,14],"x":15.25,"y":2.25}
];


/* 生成 */
const LAYOUT = rawLayout.map(k=>({
id:`k${k.matrix[0]}_${k.matrix[1]}`,
x:k.x,
y:k.y,
w:k.w||1
}));


/* =========================
   ⭐ 4レイヤー初期 keymap
========================= */

function blank(){
const o={}
LAYOUT.forEach(k=>o[k.id]='KC_TRNS')
return o
}

let layers=[
{name:'MAC_BASE',keys:blank()},
{name:'MAC_FN',keys:blank()},
{name:'WIN_BASE',keys:blank()},
{name:'WIN_FN',keys:blank()}
]


/* =========================
   描画
========================= */

let currentLayer=0
let selectedKey=null

function renderTabs(){
document.getElementById('layerTabs').innerHTML=
layers.map((l,i)=>
`<div class="layer-tab ${i===currentLayer?'active':''}" onclick="switchLayer(${i})">${l.name}</div>`
).join('')
}

function renderKeyboard(){
const size=50
const maxX=Math.max(...LAYOUT.map(k=>k.x+k.w))
const maxY=Math.max(...LAYOUT.map(k=>k.y+1))

const board=document.getElementById('keyboard')
board.style.width=maxX*size+'px'
board.style.height=maxY*size+'px'

board.innerHTML=LAYOUT.map(k=>{
const kc=layers[currentLayer].keys[k.id]
return `<div class="key ${kc==='KC_TRNS'?'transparent':''}"
style="left:${k.x*size}px;top:${k.y*size}px;width:${k.w*size}px"
onclick="selectKey('${k.id}')">${kc.replace('KC_','')}</div>`
}).join('')
}

function switchLayer(i){
currentLayer=i
renderTabs()
renderKeyboard()
}

function selectKey(id){
selectedKey=id
document.getElementById('editorPanel').style.display='block'
document.getElementById('keycodeInput').value=layers[currentLayer].keys[id]
}

function applyKeycode(){
layers[currentLayer].keys[selectedKey]=document.getElementById('keycodeInput').value
renderKeyboard()
}

function closeEditor(){
document.getElementById('editorPanel').style.display='none'
}

renderTabs()
renderKeyboard()

</script>
</body>
</html>
:::
